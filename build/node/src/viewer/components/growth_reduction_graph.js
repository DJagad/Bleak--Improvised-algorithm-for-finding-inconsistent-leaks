"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const React = require("react");
const d3_1 = require("d3");
const BYTES_PER_MB = 1024 * 1024;
function countNonNull(count, a) {
    if (Array.isArray(a)) {
        const aCount = a.reduce(countNonNull, 0);
        if (aCount !== a.length) {
            return count;
        }
        else {
            return count + 1;
        }
    }
    if (a) {
        return count + 1;
    }
    else {
        return count;
    }
}
function isRankingEvaluationComplete(results) {
    const numLeaks = results.rankingEvaluation.leakShare.length;
    try {
        const zeroLeaksFixed = results.rankingEvaluation.leakShare[0];
        const allLeaksFixed = results.rankingEvaluation.leakShare[numLeaks - 1];
        // Make sure all of the data is there!
        if (!zeroLeaksFixed || !allLeaksFixed || zeroLeaksFixed.reduce(countNonNull, 0) < zeroLeaksFixed.length || allLeaksFixed.reduce(countNonNull, 0) < allLeaksFixed.length) {
            return false;
        }
        return true;
    }
    catch (e) {
        return false;
    }
}
exports.isRankingEvaluationComplete = isRankingEvaluationComplete;
function averageGrowth(data) {
    // HS => Growth
    const growthData = data.map((d, i) => d.slice(1).map((d, j) => (d.totalSize - data[i][j].totalSize) / BYTES_PER_MB));
    // Growth => Avg Growth
    let avgGrowths = [];
    const iterations = data[0].length;
    for (let i = 0; i < iterations; i++) {
        avgGrowths.push(d3_1.mean(growthData.map((d) => d[i])));
    }
    const se = d3_1.deviation(avgGrowths.slice(4)) / Math.sqrt(avgGrowths.length - 4);
    const meanData = d3_1.mean(avgGrowths.slice(4));
    if (isNaN(se)) {
        return {
            mean: meanData
        };
    }
    return {
        mean: meanData,
        se
    };
}
exports.averageGrowth = averageGrowth;
function averageGrowthReduction(avgGrowthNoFixed, allFixed) {
    const avgGrowthAllFixed = averageGrowth(allFixed);
    const growthReduction = avgGrowthNoFixed.mean - avgGrowthAllFixed.mean;
    const percent = 100 * (growthReduction / avgGrowthNoFixed.mean);
    if (avgGrowthNoFixed.se !== undefined) {
        const growthReductionSe = Math.sqrt(Math.pow(avgGrowthAllFixed.se, 2) + Math.pow(avgGrowthNoFixed.se, 2));
        const percentSe = 100 * Math.abs((avgGrowthNoFixed.mean - avgGrowthAllFixed.mean) / avgGrowthNoFixed.mean) * Math.sqrt(Math.pow(growthReductionSe / growthReduction, 2) + Math.pow(avgGrowthNoFixed.se / avgGrowthNoFixed.mean, 2));
        return {
            mean: growthReduction,
            se: growthReductionSe,
            percent,
            percentSe
        };
    }
    else {
        return {
            mean: growthReduction,
            percent
        };
    }
}
exports.averageGrowthReduction = averageGrowthReduction;
// TODO: Support toggling different size stats, not just totalSize.
class GrowthReductionGraph extends React.Component {
    constructor() {
        super(...arguments);
        this._resizeListener = this._updateGraph.bind(this);
    }
    componentDidMount() {
        this._updateGraph();
        window.addEventListener('resize', this._resizeListener);
    }
    componentDidUpdate() {
        this._updateGraph();
    }
    componentWillUnmount() {
        window.removeEventListener('resize', this._resizeListener);
    }
    _updateGraph() {
        if (!this._hasHeapStats()) {
            return;
        }
        const d3div = this.refs['d3_div'];
        if (d3div.childNodes && d3div.childNodes.length > 0) {
            const nodes = [];
            for (let i = 0; i < d3div.childNodes.length; i++) {
                nodes.push(d3div.childNodes[i]);
            }
            nodes.forEach((n) => d3div.removeChild(n));
        }
        const svg = d3_1.select(d3div).append("svg");
        const svgStyle = getComputedStyle(svg.node());
        const margins = { left: 65, right: 20, top: 10, bottom: 35 };
        const svgHeight = parseFloat(svgStyle.height);
        const svgWidth = parseFloat(svgStyle.width);
        const radius = 3;
        const tickSize = 6;
        const rankings = ['leakShare', 'retainedSize', 'transitiveClosureSize'];
        const rankEval = this.props.bleakResults.rankingEvaluation;
        // Check if zero point is same or different across rankings.
        // Hack for legacy airbnb data, which has different data for the "no
        // fixes" run across the three metrics (which we leverage to give us
        // tighter error bars on that number / repro the numbers in the paper).
        //
        // On all data produced by BLeak moving forward, the data for the "no fixes"
        // run is the same / shared across metrics -- so we just use the data reported
        // for one metric as the base case.
        let zeroPointData = rankEval.leakShare[0];
        if (zeroPointData[0][0].totalSize !== rankEval.retainedSize[0][0][0].totalSize) {
            // Different data, so can use.
            zeroPointData = [].concat(rankEval.leakShare[0], rankEval.retainedSize[0], rankEval.transitiveClosureSize[0]);
        }
        const zeroPoint = averageGrowth(zeroPointData);
        const state = {
            leakShare: null,
            retainedSize: null,
            transitiveClosureSize: null
        };
        const lines = rankings.map((ranking) => {
            const line = {
                name: ranking,
                value: rankEval[ranking].map((d) => (zeroPoint.mean - averageGrowth(d).mean) * 1024)
            };
            if (rankEval[ranking][0].length > 1) {
                line.se = rankEval[ranking].map((d) => (Math.sqrt(Math.pow(zeroPoint.se, 2) + Math.pow(averageGrowth(d).se, 2)) * 1024));
            }
            return line;
        });
        rankings.forEach((ranking) => {
            state[ranking] = rankEval[ranking].map((d) => zeroPoint.mean - averageGrowth(d).mean * 1024);
        });
        const maxHeapSize = 1.02 * d3_1.max(lines.map((l) => d3_1.max(l.value.map((v, i) => v + (l.se ? (1.96 * l.se[i]) : 0)))));
        const minHeapSize = 0.98 * d3_1.min(lines.map((l) => d3_1.min(l.value.map((v, i) => v - (l.se ? (1.96 * l.se[i]) : 0)))));
        const plotWidth = svgWidth - margins.left - margins.right;
        const plotHeight = svgHeight - margins.top - margins.bottom;
        const x = d3_1.scaleLinear()
            .range([0, plotWidth])
            .domain([0, lines[0].value.length - 1]);
        const y = d3_1.scaleLinear().range([plotHeight, 0])
            .domain([minHeapSize, maxHeapSize]);
        const valueline = d3_1.line()
            .x(function (d) { return x(d[0]); })
            .y(function (d) { return y(d[1]); });
        const data = lines.map((l) => d3_1.zip(d3_1.range(0, l.value.length), l.value, l.se ? l.se : d3_1.range(0, l.value.length)));
        const g = svg.append("g").attr('transform', `translate(${margins.left}, ${margins.top})`);
        const plots = g.selectAll("g.plot")
            .data(data)
            .enter()
            .append('g')
            .attr('class', (d, i) => `plot plot_${i}`);
        const hasError = !!lines[0].se;
        const self = this;
        function drawPointsAndErrorBars(d, i) {
            // Prevent overlapping points / bars
            const move = i * 5;
            const g = d3_1.select(this)
                .selectAll('circle')
                .data(d)
                .enter()
                .append('g')
                .attr('class', 'data-point')
                .attr('data-placement', 'left')
                .attr('title', (d) => `${lines[i].name} ${d[0]} Leaks Fixed: ${self._presentStat(d[1], 'KB', hasError ? d[2] : undefined)}`)
                .each((_, __, g) => {
                for (let i = 0; i < g.length; i++) {
                    $(g[i]).tooltip();
                }
            });
            g.append('circle')
                .attr('r', radius)
                .attr('cx', (d) => x(d[0]) + move)
                .attr('cy', (d) => y(d[1]));
            if (hasError) {
                // Straight line
                g.append("line")
                    .attr("class", "error-line")
                    .attr("x1", function (d) {
                    return x(d[0]) + move;
                })
                    .attr("y1", function (d) {
                    return y(d[1] + (1.96 * d[2]));
                })
                    .attr("x2", function (d) {
                    return x(d[0]) + move;
                })
                    .attr("y2", function (d) {
                    return y(d[1] - (1.96 * d[2]));
                });
                // Top cap
                g.append("line")
                    .attr("class", "error-cap")
                    .attr("x1", function (d) {
                    return x(d[0]) - 4 + move;
                })
                    .attr("y1", function (d) {
                    return y(d[1] + (1.96 * d[2]));
                })
                    .attr("x2", function (d) {
                    return x(d[0]) + 4 + move;
                })
                    .attr("y2", function (d) {
                    return y(d[1] + (1.96 * d[2]));
                });
                // Bottom cap
                g.append("line")
                    .attr("class", "error-cap")
                    .attr("x1", function (d) {
                    return x(d[0]) - 4 + move;
                })
                    .attr("y1", function (d) {
                    return y(d[1] - (1.96 * d[2]));
                })
                    .attr("x2", function (d) {
                    return x(d[0]) + 4 + move;
                })
                    .attr("y2", function (d) {
                    return y(d[1] - (1.96 * d[2]));
                });
            }
        }
        plots.append('path')
            .attr("class", 'line')
            .attr("d", valueline);
        plots.each(drawPointsAndErrorBars);
        // Add the X Axis
        g.append("g")
            .attr('class', 'xaxis')
            .attr("transform", `translate(0,${plotHeight})`)
            .call(d3_1.axisBottom(x).tickSizeOuter(tickSize).tickFormat((n) => {
            let val = typeof (n) === 'number' ? n : n.valueOf();
            if (Math.floor(val) !== val) {
                // Drop the tick mark.
                return undefined;
            }
            return n;
        }));
        // Add the Y Axis
        g.append("g")
            .attr('class', 'yaxis')
            .call(d3_1.axisLeft(y).tickSizeOuter(tickSize).tickFormat((n) => `${n} KB`));
        // Add X axis title
        g.append('text')
            .attr('class', 'xtitle')
            .attr('x', plotWidth >> 1)
            .attr('y', 32) // Approximate height of x axis
            .attr('transform', `translate(0, ${plotHeight})`)
            .style('text-anchor', 'middle')
            .text('Top Ranked Leak Roots Fixed');
        // Add Y axis title
        g.append('text')
            .attr('class', 'ytitle')
            .attr('x', -1 * (plotHeight >> 1)) // x and y are flipped because of rotation
            .attr('y', -58) // Approximate width of y-axis
            .attr('transform', 'rotate(-90)')
            .style('text-anchor', 'middle')
            .style('alignment-baseline', 'central')
            .text('Growth Reduction');
        if (lines.length > 1) {
            // Put up a legend
            const legend = g.append('g')
                .attr('class', 'legend')
                .attr('transform', `translate(15, 15)`);
            const rect = legend.append('rect');
            const legendItems = legend.append('g')
                .attr('class', 'legend-items');
            const liWithData = legendItems.selectAll('text')
                .data(lines)
                .enter();
            liWithData.append('text')
                .attr('x', '1.3em')
                .attr('y', (l, i) => `${i}em`)
                .text((l) => l.name);
            liWithData.append('line')
                .attr('class', (_, i) => `plot_${i}`)
                .attr('x1', 0)
                .attr('y1', (d, i) => `${i - 0.3}em`)
                .attr('x2', `1em`)
                .attr('y2', (d, i) => `${i - 0.3}em`);
            // x, y, height, width
            const bbox = legendItems.node().getBBox();
            rect.attr('x', bbox.x - 5)
                .attr('y', bbox.y - 5)
                .attr('height', bbox.height + 10)
                .attr('width', bbox.width + 10);
        }
    }
    _hasHeapStats() {
        return !!this.props.bleakResults.heapStats && this.props.bleakResults.heapStats.length > 0;
    }
    _presentStat(stat, metric, se) {
        return `${stat.toFixed(2)}${metric}${se ? `, 95% CI [${(stat - (1.96 * se)).toFixed(2)}, ${(stat + (1.96 * se)).toFixed(2)}]` : ''}`;
    }
    render() {
        // TODO: Growth reduction.
        return React.createElement("div", null, this._hasHeapStats() ?
            React.createElement("div", { ref: "d3_div", className: "heap-growth-graph" })
            : '');
    }
}
exports.default = GrowthReductionGraph;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3Jvd3RoX3JlZHVjdGlvbl9ncmFwaC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy92aWV3ZXIvY29tcG9uZW50cy9ncm93dGhfcmVkdWN0aW9uX2dyYXBoLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtCQUErQjtBQUUvQiwyQkFDbUc7QUFhbkcsTUFBTSxZQUFZLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQztBQUVqQyxzQkFBeUIsS0FBYSxFQUFFLENBQVU7SUFDaEQsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckIsTUFBTSxNQUFNLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDekMsRUFBRSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDZixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixNQUFNLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNuQixDQUFDO0lBQ0gsQ0FBQztJQUNELEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDTixNQUFNLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztJQUNuQixDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2YsQ0FBQztBQUNILENBQUM7QUFFRCxxQ0FBNEMsT0FBcUI7SUFDL0QsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7SUFDNUQsSUFBSSxDQUFDO1FBQ0gsTUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5RCxNQUFNLGFBQWEsR0FB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Q0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQzdGLENBQUM7SUFFTyxZQUFZLENBQUMsSUFBWSxFQUFFLE1BQWMsRUFBRSxFQUFXO1FBQzVELE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQTtJQUN0SSxDQUFDO0lBRU0sTUFBTTtRQUNYLDBCQUEwQjtRQUMxQixNQUFNLENBQUMsaUNBQ0osSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUM7WUFDckIsNkJBQUssR0FBRyxFQUFDLFFBQVEsRUFBQyxTQUFTLEVBQUMsbUJBQW1CLEdBQ3pDO1lBQ1IsQ0FBQyxDQUFDLEVBQUUsQ0FDQSxDQUFDO0lBQ1QsQ0FBQztDQUNGO0FBcFJELHVDQW9SQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBCTGVha1Jlc3VsdHMgZnJvbSAnLi4vLi4vbGliL2JsZWFrX3Jlc3VsdHMnO1xuaW1wb3J0IHtzY2FsZUxpbmVhciBhcyBkM1NjYWxlTGluZWFyLCBsaW5lIGFzIGQzTGluZSwgc2VsZWN0IGFzIGQzU2VsZWN0LFxuICAgICAgICBheGlzQm90dG9tLCBheGlzTGVmdCwgbWVhbiwgZGV2aWF0aW9uLCBtYXgsIHppcCBhcyBkM1ppcCwgcmFuZ2UgYXMgZDNSYW5nZSwgbWlufSBmcm9tICdkMyc7XG5pbXBvcnQge1NuYXBzaG90U2l6ZVN1bW1hcnl9IGZyb20gJy4uLy4uL2NvbW1vbi9pbnRlcmZhY2VzJztcblxuaW50ZXJmYWNlIEdyb3d0aFJlZHVjdGlvbkdyYXBoUHJvcHMge1xuICBibGVha1Jlc3VsdHM6IEJMZWFrUmVzdWx0cztcbn1cblxuaW50ZXJmYWNlIExpbmUge1xuICBuYW1lOiBzdHJpbmc7XG4gIHZhbHVlOiBudW1iZXJbXTtcbiAgc2U/OiBudW1iZXJbXTtcbn1cblxuY29uc3QgQllURVNfUEVSX01CID0gMTAyNCAqIDEwMjQ7XG5cbmZ1bmN0aW9uIGNvdW50Tm9uTnVsbDxUPihjb3VudDogbnVtYmVyLCBhOiBUW10gfCBUKTogbnVtYmVyIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoYSkpIHtcbiAgICBjb25zdCBhQ291bnQgPSBhLnJlZHVjZShjb3VudE5vbk51bGwsIDApO1xuICAgIGlmIChhQ291bnQgIT09IGEubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gY291bnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBjb3VudCArIDE7XG4gICAgfVxuICB9XG4gIGlmIChhKSB7XG4gICAgcmV0dXJuIGNvdW50ICsgMTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY291bnQ7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzUmFua2luZ0V2YWx1YXRpb25Db21wbGV0ZShyZXN1bHRzOiBCTGVha1Jlc3VsdHMpOiBib29sZWFuIHtcbiAgY29uc3QgbnVtTGVha3MgPSByZXN1bHRzLnJhbmtpbmdFdmFsdWF0aW9uLmxlYWtTaGFyZS5sZW5ndGg7XG4gIHRyeSB7XG4gICAgY29uc3QgemVyb0xlYWtzRml4ZWQgPSByZXN1bHRzLnJhbmtpbmdFdmFsdWF0aW9uLmxlYWtTaGFyZVswXTtcbiAgICBjb25zdCBhbGxMZWFrc0ZpeGVkID0gcmVzdWx0cy5yYW5raW5nRXZhbHVhdGlvbi5sZWFrU2hhcmVbbnVtTGVha3MgLSAxXTtcbiAgICAvLyBNYWtlIHN1cmUgYWxsIG9mIHRoZSBkYXRhIGlzIHRoZXJlIVxuICAgIGlmICghemVyb0xlYWtzRml4ZWQgfHwgIWFsbExlYWtzRml4ZWQgfHwgemVyb0xlYWtzRml4ZWQucmVkdWNlKGNvdW50Tm9uTnVsbCwgMCkgPCB6ZXJvTGVha3NGaXhlZC5sZW5ndGggfHwgYWxsTGVha3NGaXhlZC5yZWR1Y2UoY291bnROb25OdWxsLCAwKSA8IGFsbExlYWtzRml4ZWQubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhdmVyYWdlR3Jvd3RoKGRhdGE6IFNuYXBzaG90U2l6ZVN1bW1hcnlbXVtdKTogeyBtZWFuOiBudW1iZXIsIHNlPzogbnVtYmVyIH0ge1xuICAvLyBIUyA9PiBHcm93dGhcbiAgY29uc3QgZ3Jvd3RoRGF0YSA9IGRhdGEubWFwKChkLCBpKSA9PiBkLnNsaWNlKDEpLm1hcCgoZCwgaikgPT4gKGQudG90YWxTaXplIC0gZGF0YVtpXVtqXS50b3RhbFNpemUpIC8gQllURVNfUEVSX01CKSk7XG4gIC8vIEdyb3d0aCA9PiBBdmcgR3Jvd3RoXG4gIGxldCBhdmdHcm93dGhzOiBudW1iZXJbXSA9IFtdO1xuICBjb25zdCBpdGVyYXRpb25zID0gZGF0YVswXS5sZW5ndGg7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlcmF0aW9uczsgaSsrKSB7XG4gICAgYXZnR3Jvd3Rocy5wdXNoKG1lYW4oZ3Jvd3RoRGF0YS5tYXAoKGQpID0+IGRbaV0pKSk7XG4gIH1cbiAgY29uc3Qgc2UgPSBkZXZpYXRpb24oYXZnR3Jvd3Rocy5zbGljZSg0KSkgLyBNYXRoLnNxcnQoYXZnR3Jvd3Rocy5sZW5ndGggLSA0KTtcbiAgY29uc3QgbWVhbkRhdGEgPSBtZWFuKGF2Z0dyb3d0aHMuc2xpY2UoNCkpO1xuICBpZiAoaXNOYU4oc2UpKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1lYW46IG1lYW5EYXRhXG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIG1lYW46IG1lYW5EYXRhLFxuICAgIHNlXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhdmVyYWdlR3Jvd3RoUmVkdWN0aW9uKGF2Z0dyb3d0aE5vRml4ZWQ6IHsgbWVhbjogbnVtYmVyLCBzZT86IG51bWJlcn0sIGFsbEZpeGVkOiBTbmFwc2hvdFNpemVTdW1tYXJ5W11bXSk6IHsgbWVhbjogbnVtYmVyLCBzZT86IG51bWJlciwgcGVyY2VudDogbnVtYmVyLCBwZXJjZW50U2U/OiBudW1iZXIgfSB7XG4gIGNvbnN0IGF2Z0dyb3d0aEFsbEZpeGVkID0gYXZlcmFnZUdyb3d0aChhbGxGaXhlZCk7XG4gIGNvbnN0IGdyb3d0aFJlZHVjdGlvbiA9IGF2Z0dyb3d0aE5vRml4ZWQubWVhbiAtIGF2Z0dyb3d0aEFsbEZpeGVkLm1lYW47XG4gIGNvbnN0IHBlcmNlbnQgPSAxMDAgKiAoZ3Jvd3RoUmVkdWN0aW9uIC8gYXZnR3Jvd3RoTm9GaXhlZC5tZWFuKTtcbiAgaWYgKGF2Z0dyb3d0aE5vRml4ZWQuc2UgIT09IHVuZGVmaW5lZCkge1xuICAgIGNvbnN0IGdyb3d0aFJlZHVjdGlvblNlID0gTWF0aC5zcXJ0KE1hdGgucG93KGF2Z0dyb3d0aEFsbEZpeGVkLnNlLCAyKSArIE1hdGgucG93KGF2Z0dyb3d0aE5vRml4ZWQuc2UsIDIpKTtcbiAgICBjb25zdCBwZXJjZW50U2UgPSAxMDAgKiBNYXRoLmFicygoYXZnR3Jvd3RoTm9GaXhlZC5tZWFuIC0gYXZnR3Jvd3RoQWxsRml4ZWQubWVhbikgLyBhdmdHcm93dGhOb0ZpeGVkLm1lYW4pICogTWF0aC5zcXJ0KE1hdGgucG93KGdyb3d0aFJlZHVjdGlvblNlIC8gZ3Jvd3RoUmVkdWN0aW9uLCAyKSArIE1hdGgucG93KGF2Z0dyb3d0aE5vRml4ZWQuc2UgLyBhdmdHcm93dGhOb0ZpeGVkLm1lYW4sIDIpKTtcbiAgICByZXR1cm4ge1xuICAgICAgbWVhbjogZ3Jvd3RoUmVkdWN0aW9uLFxuICAgICAgc2U6IGdyb3d0aFJlZHVjdGlvblNlLFxuICAgICAgcGVyY2VudCxcbiAgICAgIHBlcmNlbnRTZVxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1lYW46IGdyb3d0aFJlZHVjdGlvbixcbiAgICAgIHBlcmNlbnRcbiAgICB9O1xuICB9XG59XG5cbi8vIFRPRE86IFN1cHBvcnQgdG9nZ2xpbmcgZGlmZmVyZW50IHNpemUgc3RhdHMsIG5vdCBqdXN0IHRvdGFsU2l6ZS5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdyb3d0aFJlZHVjdGlvbkdyYXBoIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PEdyb3d0aFJlZHVjdGlvbkdyYXBoUHJvcHMsIHt9PiB7XG4gIHByaXZhdGUgX3Jlc2l6ZUxpc3RlbmVyID0gdGhpcy5fdXBkYXRlR3JhcGguYmluZCh0aGlzKTtcblxuICBwdWJsaWMgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgdGhpcy5fdXBkYXRlR3JhcGgoKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5fcmVzaXplTGlzdGVuZXIpO1xuICB9XG5cbiAgcHVibGljIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLl91cGRhdGVHcmFwaCgpO1xuICB9XG5cbiAgcHVibGljIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLl9yZXNpemVMaXN0ZW5lcik7XG4gIH1cblxuICBwcml2YXRlIF91cGRhdGVHcmFwaCgpIHtcbiAgICBpZiAoIXRoaXMuX2hhc0hlYXBTdGF0cygpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGQzZGl2ID0gdGhpcy5yZWZzWydkM19kaXYnXSBhcyBIVE1MRGl2RWxlbWVudDtcbiAgICBpZiAoZDNkaXYuY2hpbGROb2RlcyAmJiBkM2Rpdi5jaGlsZE5vZGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IG5vZGVzOiBOb2RlW10gPSBbXTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZDNkaXYuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBub2Rlcy5wdXNoKGQzZGl2LmNoaWxkTm9kZXNbaV0pO1xuICAgICAgfVxuICAgICAgbm9kZXMuZm9yRWFjaCgobikgPT4gZDNkaXYucmVtb3ZlQ2hpbGQobikpO1xuICAgIH1cblxuICAgIGNvbnN0IHN2ZyA9IGQzU2VsZWN0KGQzZGl2KS5hcHBlbmQ8U1ZHRWxlbWVudD4oXCJzdmdcIik7XG4gICAgY29uc3Qgc3ZnU3R5bGUgPSBnZXRDb21wdXRlZFN0eWxlKHN2Zy5ub2RlKCkpO1xuICAgIGNvbnN0IG1hcmdpbnMgPSB7bGVmdDogNjUsIHJpZ2h0OiAyMCwgdG9wOiAxMCwgYm90dG9tOiAzNX07XG4gICAgY29uc3Qgc3ZnSGVpZ2h0ID0gcGFyc2VGbG9hdChzdmdTdHlsZS5oZWlnaHQpO1xuICAgIGNvbnN0IHN2Z1dpZHRoID0gcGFyc2VGbG9hdChzdmdTdHlsZS53aWR0aCk7XG4gICAgY29uc3QgcmFkaXVzID0gMztcbiAgICBjb25zdCB0aWNrU2l6ZSA9IDY7XG5cbiAgICBjb25zdCByYW5raW5nczogKCdsZWFrU2hhcmUnIHwgJ3JldGFpbmVkU2l6ZScgfCAndHJhbnNpdGl2ZUNsb3N1cmVTaXplJylbXSA9IFsnbGVha1NoYXJlJywgJ3JldGFpbmVkU2l6ZScsICd0cmFuc2l0aXZlQ2xvc3VyZVNpemUnXVxuICAgIGNvbnN0IHJhbmtFdmFsID0gdGhpcy5wcm9wcy5ibGVha1Jlc3VsdHMucmFua2luZ0V2YWx1YXRpb247XG5cbiAgICAvLyBDaGVjayBpZiB6ZXJvIHBvaW50IGlzIHNhbWUgb3IgZGlmZmVyZW50IGFjcm9zcyByYW5raW5ncy5cbiAgICAvLyBIYWNrIGZvciBsZWdhY3kgYWlyYm5iIGRhdGEsIHdoaWNoIGhhcyBkaWZmZXJlbnQgZGF0YSBmb3IgdGhlIFwibm9cbiAgICAvLyBmaXhlc1wiIHJ1biBhY3Jvc3MgdGhlIHRocmVlIG1ldHJpY3MgKHdoaWNoIHdlIGxldmVyYWdlIHRvIGdpdmUgdXNcbiAgICAvLyB0aWdodGVyIGVycm9yIGJhcnMgb24gdGhhdCBudW1iZXIgLyByZXBybyB0aGUgbnVtYmVycyBpbiB0aGUgcGFwZXIpLlxuICAgIC8vXG4gICAgLy8gT24gYWxsIGRhdGEgcHJvZHVjZWQgYnkgQkxlYWsgbW92aW5nIGZvcndhcmQsIHRoZSBkYXRhIGZvciB0aGUgXCJubyBmaXhlc1wiXG4gICAgLy8gcnVuIGlzIHRoZSBzYW1lIC8gc2hhcmVkIGFjcm9zcyBtZXRyaWNzIC0tIHNvIHdlIGp1c3QgdXNlIHRoZSBkYXRhIHJlcG9ydGVkXG4gICAgLy8gZm9yIG9uZSBtZXRyaWMgYXMgdGhlIGJhc2UgY2FzZS5cbiAgICBsZXQgemVyb1BvaW50RGF0YSA9IHJhbmtFdmFsLmxlYWtTaGFyZVswXTtcbiAgICBpZiAoemVyb1BvaW50RGF0YVswXVswXS50b3RhbFNpemUgIT09IHJhbmtFdmFsLnJldGFpbmVkU2l6ZVswXVswXVswXS50b3RhbFNpemUpIHtcbiAgICAgIC8vIERpZmZlcmVudCBkYXRhLCBzbyBjYW4gdXNlLlxuICAgICAgemVyb1BvaW50RGF0YSA9IFtdLmNvbmNhdChyYW5rRXZhbC5sZWFrU2hhcmVbMF0sIHJhbmtFdmFsLnJldGFpbmVkU2l6ZVswXSwgcmFua0V2YWwudHJhbnNpdGl2ZUNsb3N1cmVTaXplWzBdKTtcbiAgICB9XG4gICAgY29uc3QgemVyb1BvaW50ID0gYXZlcmFnZUdyb3d0aCh6ZXJvUG9pbnREYXRhKTtcbiAgICBjb25zdCBzdGF0ZSA9IHtcbiAgICAgIGxlYWtTaGFyZTogbnVsbCBhcyBudW1iZXJbXSxcbiAgICAgIHJldGFpbmVkU2l6ZTogbnVsbCBhcyBudW1iZXJbXSxcbiAgICAgIHRyYW5zaXRpdmVDbG9zdXJlU2l6ZTogbnVsbCBhcyBudW1iZXJbXVxuICAgIH07XG5cbiAgICBjb25zdCBsaW5lcyA9IHJhbmtpbmdzLm1hcCgocmFua2luZykgPT4ge1xuICAgICAgY29uc3QgbGluZTogTGluZSA9IHtcbiAgICAgICAgbmFtZTogcmFua2luZyxcbiAgICAgICAgdmFsdWU6IHJhbmtFdmFsW3JhbmtpbmddLm1hcCgoZCkgPT4gKHplcm9Qb2ludC5tZWFuIC0gYXZlcmFnZUdyb3d0aChkKS5tZWFuKSAqIDEwMjQpXG4gICAgICB9O1xuICAgICAgaWYgKHJhbmtFdmFsW3JhbmtpbmddWzBdLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgbGluZS5zZSA9IHJhbmtFdmFsW3JhbmtpbmddLm1hcCgoZCkgPT4gKE1hdGguc3FydChNYXRoLnBvdyh6ZXJvUG9pbnQuc2UsIDIpICsgTWF0aC5wb3coYXZlcmFnZUdyb3d0aChkKS5zZSwgMikpICogMTAyNCkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGxpbmU7XG4gICAgfSk7XG4gICAgcmFua2luZ3MuZm9yRWFjaCgocmFua2luZykgPT4ge1xuICAgICAgc3RhdGVbcmFua2luZ10gPSAgcmFua0V2YWxbcmFua2luZ10ubWFwKChkKSA9PiB6ZXJvUG9pbnQubWVhbiAtIGF2ZXJhZ2VHcm93dGgoZCkubWVhbiAqIDEwMjQpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgbWF4SGVhcFNpemUgPSAxLjAyICogbWF4KGxpbmVzLm1hcCgobCkgPT4gbWF4KGwudmFsdWUubWFwKCh2LCBpKSA9PiB2ICsgKGwuc2UgPyAoMS45NiAqIGwuc2VbaV0pIDogMCkpKSkpO1xuICAgIGNvbnN0IG1pbkhlYXBTaXplID0gMC45OCAqIG1pbihsaW5lcy5tYXAoKGwpID0+IG1pbihsLnZhbHVlLm1hcCgodiwgaSkgPT4gdiAtIChsLnNlID8gKDEuOTYgKiBsLnNlW2ldKSA6IDApKSkpKTtcblxuICAgIGNvbnN0IHBsb3RXaWR0aCA9IHN2Z1dpZHRoIC0gbWFyZ2lucy5sZWZ0IC0gbWFyZ2lucy5yaWdodDtcbiAgICBjb25zdCBwbG90SGVpZ2h0ID0gc3ZnSGVpZ2h0IC0gbWFyZ2lucy50b3AgLSBtYXJnaW5zLmJvdHRvbTtcblxuICAgIGNvbnN0IHggPSBkM1NjYWxlTGluZWFyKClcbiAgICAgIC5yYW5nZShbMCwgcGxvdFdpZHRoXSlcbiAgICAgIC5kb21haW4oWzAsIGxpbmVzWzBdLnZhbHVlLmxlbmd0aCAtIDFdKTtcbiAgICBjb25zdCB5ID0gZDNTY2FsZUxpbmVhcigpLnJhbmdlKFtwbG90SGVpZ2h0LCAwXSlcbiAgICAgIC5kb21haW4oW21pbkhlYXBTaXplLCBtYXhIZWFwU2l6ZV0pO1xuXG4gICAgY29uc3QgdmFsdWVsaW5lID0gZDNMaW5lPFtudW1iZXIsIG51bWJlciwgbnVtYmVyXT4oKVxuICAgICAgLngoZnVuY3Rpb24oZCkgeyByZXR1cm4geChkWzBdKTsgfSlcbiAgICAgIC55KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHkoZFsxXSk7IH0pO1xuXG4gICAgY29uc3QgZGF0YSA9IGxpbmVzLm1hcCgobCk6IFtudW1iZXIsIG51bWJlciwgbnVtYmVyXVtdID0+XG4gICAgICBkM1ppcChkM1JhbmdlKDAsIGwudmFsdWUubGVuZ3RoKSwgbC52YWx1ZSwgbC5zZSA/IGwuc2UgOiBkM1JhbmdlKDAsIGwudmFsdWUubGVuZ3RoKSkgYXMgW251bWJlciwgbnVtYmVyLCBudW1iZXJdW11cbiAgICApO1xuXG4gICAgY29uc3QgZyA9IHN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUoJHttYXJnaW5zLmxlZnR9LCAke21hcmdpbnMudG9wfSlgKTtcblxuICAgIGNvbnN0IHBsb3RzID0gZy5zZWxlY3RBbGwoXCJnLnBsb3RcIilcbiAgICAgIC5kYXRhKGRhdGEpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAuYXR0cignY2xhc3MnLCAoZCwgaSkgPT4gYHBsb3QgcGxvdF8ke2l9YCk7XG5cbiAgICBjb25zdCBoYXNFcnJvciA9ICEhbGluZXNbMF0uc2U7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgZnVuY3Rpb24gZHJhd1BvaW50c0FuZEVycm9yQmFycyh0aGlzOiBFbGVtZW50LCBkOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl1bXSwgaTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAvLyBQcmV2ZW50IG92ZXJsYXBwaW5nIHBvaW50cyAvIGJhcnNcbiAgICAgIGNvbnN0IG1vdmUgPSBpICogNTtcbiAgICAgIGNvbnN0IGcgPSBkM1NlbGVjdCh0aGlzKVxuICAgICAgICAuc2VsZWN0QWxsKCdjaXJjbGUnKVxuICAgICAgICAuZGF0YShkKVxuICAgICAgICAuZW50ZXIoKVxuICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2RhdGEtcG9pbnQnKVxuICAgICAgICAuYXR0cignZGF0YS1wbGFjZW1lbnQnLCAnbGVmdCcpXG4gICAgICAgIC5hdHRyKCd0aXRsZScsIChkKSA9PiBgJHtsaW5lc1tpXS5uYW1lfSAke2RbMF19IExlYWtzIEZpeGVkOiAke3NlbGYuX3ByZXNlbnRTdGF0KGRbMV0sICdLQicsIGhhc0Vycm9yID8gZFsyXSA6IHVuZGVmaW5lZCl9YClcbiAgICAgICAgLmVhY2goKF8sIF9fLCBnKSA9PiB7XG4gICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAkKGdbaV0pLnRvb2x0aXAoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICBnLmFwcGVuZCgnY2lyY2xlJylcbiAgICAgICAgLmF0dHIoJ3InLCByYWRpdXMpXG4gICAgICAgIC5hdHRyKCdjeCcsIChkKSA9PiB4KGRbMF0pICsgbW92ZSlcbiAgICAgICAgLmF0dHIoJ2N5JywgKGQpID0+IHkoZFsxXSkpO1xuXG4gICAgICBpZiAoaGFzRXJyb3IpIHtcbiAgICAgICAgLy8gU3RyYWlnaHQgbGluZVxuICAgICAgICBnLmFwcGVuZChcImxpbmVcIilcbiAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiZXJyb3ItbGluZVwiKVxuICAgICAgICAgIC5hdHRyKFwieDFcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgcmV0dXJuIHgoZFswXSkgKyBtb3ZlO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmF0dHIoXCJ5MVwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICByZXR1cm4geShkWzFdICsgKDEuOTYgKiBkWzJdKSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuYXR0cihcIngyXCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgIHJldHVybiB4KGRbMF0pICsgbW92ZTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5hdHRyKFwieTJcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgcmV0dXJuIHkoZFsxXSAtICgxLjk2ICogZFsyXSkpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFRvcCBjYXBcbiAgICAgICAgZy5hcHBlbmQoXCJsaW5lXCIpXG4gICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImVycm9yLWNhcFwiKVxuICAgICAgICAgIC5hdHRyKFwieDFcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgcmV0dXJuIHgoZFswXSkgLSA0ICsgbW92ZTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5hdHRyKFwieTFcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgcmV0dXJuIHkoZFsxXSArICgxLjk2ICogZFsyXSkpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmF0dHIoXCJ4MlwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICByZXR1cm4geChkWzBdKSArIDQgKyBtb3ZlO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmF0dHIoXCJ5MlwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICByZXR1cm4geShkWzFdICsgKDEuOTYgKiBkWzJdKSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQm90dG9tIGNhcFxuICAgICAgICBnLmFwcGVuZChcImxpbmVcIilcbiAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiZXJyb3ItY2FwXCIpXG4gICAgICAgICAgLmF0dHIoXCJ4MVwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICByZXR1cm4geChkWzBdKSAtIDQgKyBtb3ZlO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmF0dHIoXCJ5MVwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICByZXR1cm4geShkWzFdIC0gKDEuOTYgKiBkWzJdKSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuYXR0cihcIngyXCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgIHJldHVybiB4KGRbMF0pICsgNCArIG1vdmU7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuYXR0cihcInkyXCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgIHJldHVybiB5KGRbMV0gLSAoMS45NiAqIGRbMl0pKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBwbG90cy5hcHBlbmQoJ3BhdGgnKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCAnbGluZScpXG4gICAgICAuYXR0cihcImRcIiwgdmFsdWVsaW5lKTtcblxuICAgIHBsb3RzLmVhY2goZHJhd1BvaW50c0FuZEVycm9yQmFycyk7XG5cblxuICAgIC8vIEFkZCB0aGUgWCBBeGlzXG4gICAgZy5hcHBlbmQoXCJnXCIpXG4gICAgICAuYXR0cignY2xhc3MnLCAneGF4aXMnKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgwLCR7cGxvdEhlaWdodH0pYClcbiAgICAgIC5jYWxsKGF4aXNCb3R0b20oeCkudGlja1NpemVPdXRlcih0aWNrU2l6ZSkudGlja0Zvcm1hdCgobikgPT4ge1xuICAgICAgICBsZXQgdmFsID0gdHlwZW9mKG4pID09PSAnbnVtYmVyJyA/IG4gOiBuLnZhbHVlT2YoKTtcbiAgICAgICAgaWYgKE1hdGguZmxvb3IodmFsKSAhPT0gdmFsKSB7XG4gICAgICAgICAgLy8gRHJvcCB0aGUgdGljayBtYXJrLlxuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQgYXMgYW55O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuO1xuICAgICAgfSkpO1xuXG4gICAgLy8gQWRkIHRoZSBZIEF4aXNcbiAgICBnLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKCdjbGFzcycsICd5YXhpcycpXG4gICAgICAuY2FsbChheGlzTGVmdCh5KS50aWNrU2l6ZU91dGVyKHRpY2tTaXplKS50aWNrRm9ybWF0KChuKSA9PiBgJHtufSBLQmApKTtcblxuICAgIC8vIEFkZCBYIGF4aXMgdGl0bGVcbiAgICBnLmFwcGVuZCgndGV4dCcpXG4gICAgICAuYXR0cignY2xhc3MnLCAneHRpdGxlJylcbiAgICAgIC5hdHRyKCd4JywgcGxvdFdpZHRoID4+IDEpXG4gICAgICAuYXR0cigneScsIDMyKSAvLyBBcHByb3hpbWF0ZSBoZWlnaHQgb2YgeCBheGlzXG4gICAgICAuYXR0cigndHJhbnNmb3JtJywgYHRyYW5zbGF0ZSgwLCAke3Bsb3RIZWlnaHR9KWApXG4gICAgICAuc3R5bGUoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAudGV4dCgnVG9wIFJhbmtlZCBMZWFrIFJvb3RzIEZpeGVkJyk7XG5cbiAgICAvLyBBZGQgWSBheGlzIHRpdGxlXG4gICAgZy5hcHBlbmQoJ3RleHQnKVxuICAgICAgLmF0dHIoJ2NsYXNzJywgJ3l0aXRsZScpXG4gICAgICAuYXR0cigneCcsIC0xICogKHBsb3RIZWlnaHQgPj4gMSkpIC8vIHggYW5kIHkgYXJlIGZsaXBwZWQgYmVjYXVzZSBvZiByb3RhdGlvblxuICAgICAgLmF0dHIoJ3knLCAtNTgpIC8vIEFwcHJveGltYXRlIHdpZHRoIG9mIHktYXhpc1xuICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsICdyb3RhdGUoLTkwKScpXG4gICAgICAuc3R5bGUoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAuc3R5bGUoJ2FsaWdubWVudC1iYXNlbGluZScsICdjZW50cmFsJylcbiAgICAgIC50ZXh0KCdHcm93dGggUmVkdWN0aW9uJyk7XG5cblxuICAgIGlmIChsaW5lcy5sZW5ndGggPiAxKSB7XG4gICAgICAvLyBQdXQgdXAgYSBsZWdlbmRcbiAgICAgIGNvbnN0IGxlZ2VuZCA9IGcuYXBwZW5kKCdnJylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2xlZ2VuZCcpXG4gICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBgdHJhbnNsYXRlKDE1LCAxNSlgKTtcblxuICAgICAgY29uc3QgcmVjdCA9IGxlZ2VuZC5hcHBlbmQoJ3JlY3QnKTtcblxuICAgICAgY29uc3QgbGVnZW5kSXRlbXMgPSBsZWdlbmQuYXBwZW5kPFNWR0dFbGVtZW50PignZycpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdsZWdlbmQtaXRlbXMnKTtcblxuICAgICAgY29uc3QgbGlXaXRoRGF0YSA9IGxlZ2VuZEl0ZW1zLnNlbGVjdEFsbCgndGV4dCcpXG4gICAgICAgIC5kYXRhKGxpbmVzKVxuICAgICAgICAuZW50ZXIoKTtcblxuICAgICAgbGlXaXRoRGF0YS5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAuYXR0cigneCcsICcxLjNlbScpXG4gICAgICAgIC5hdHRyKCd5JywgKGwsIGkpID0+IGAke2l9ZW1gKVxuICAgICAgICAudGV4dCgobCkgPT4gbC5uYW1lKTtcblxuICAgICAgbGlXaXRoRGF0YS5hcHBlbmQoJ2xpbmUnKVxuICAgICAgICAuYXR0cignY2xhc3MnLCAoXywgaSkgPT4gYHBsb3RfJHtpfWApXG4gICAgICAgIC5hdHRyKCd4MScsIDApXG4gICAgICAgIC5hdHRyKCd5MScsIChkLCBpKSA9PiBgJHtpIC0gMC4zfWVtYClcbiAgICAgICAgLmF0dHIoJ3gyJywgYDFlbWApXG4gICAgICAgIC5hdHRyKCd5MicsIChkLCBpKSA9PiBgJHtpIC0gMC4zfWVtYCk7XG5cbiAgICAgIC8vIHgsIHksIGhlaWdodCwgd2lkdGhcbiAgICAgIGNvbnN0IGJib3ggPSBsZWdlbmRJdGVtcy5ub2RlKCkuZ2V0QkJveCgpO1xuICAgICAgcmVjdC5hdHRyKCd4JywgYmJveC54IC0gNSlcbiAgICAgICAgLmF0dHIoJ3knLCBiYm94LnkgLSA1KVxuICAgICAgICAuYXR0cignaGVpZ2h0JywgYmJveC5oZWlnaHQgKyAxMClcbiAgICAgICAgLmF0dHIoJ3dpZHRoJywgYmJveC53aWR0aCArIDEwKTtcblxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX2hhc0hlYXBTdGF0cygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISF0aGlzLnByb3BzLmJsZWFrUmVzdWx0cy5oZWFwU3RhdHMgJiYgdGhpcy5wcm9wcy5ibGVha1Jlc3VsdHMuaGVhcFN0YXRzLmxlbmd0aCA+IDA7XG4gIH1cblxuICBwcml2YXRlIF9wcmVzZW50U3RhdChzdGF0OiBudW1iZXIsIG1ldHJpYzogc3RyaW5nLCBzZT86IG51bWJlcikge1xuICAgIHJldHVybiBgJHtzdGF0LnRvRml4ZWQoMil9JHttZXRyaWN9JHtzZSA/IGAsIDk1JSBDSSBbJHsoc3RhdCAtICgxLjk2ICogc2UpKS50b0ZpeGVkKDIpfSwgJHsoc3RhdCArICgxLjk2ICogc2UpKS50b0ZpeGVkKDIpfV1gIDogJyd9YFxuICB9XG5cbiAgcHVibGljIHJlbmRlcigpIHtcbiAgICAvLyBUT0RPOiBHcm93dGggcmVkdWN0aW9uLlxuICAgIHJldHVybiA8ZGl2PlxuICAgICAge3RoaXMuX2hhc0hlYXBTdGF0cygpID9cbiAgICAgICAgPGRpdiByZWY9XCJkM19kaXZcIiBjbGFzc05hbWU9XCJoZWFwLWdyb3d0aC1ncmFwaFwiPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDogJyd9XG4gICAgPC9kaXY+O1xuICB9XG59XG4iXX0=